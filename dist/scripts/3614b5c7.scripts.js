"use strict";angular.module("mctApp",["ngRoute","ngSanitize","ngResource"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/posts",{templateUrl:"views/posts/index.html",controller:"PostsCtrl"}).when("/posts/new",{templateUrl:"views/posts/new.html",controller:"NewPostCtrl"}).when("/posts/:name",{templateUrl:"views/posts/show.html",controller:"ShowPostCtrl"}).when("/posts/:name/edit",{templateUrl:"views/posts/edit.html",controller:"EditPostCtrl"}).when("/molecules",{templateUrl:"views/molecules/index.html",controller:"MoleculesCtrl"}).when("/molecules/new",{templateUrl:"views/molecules/sketcher.html",controller:"MoleculeSketcherCtrl"}).when("/molecules/:name",{templateUrl:"views/molecules/show.html",controller:"ShowMoleculeCtrl"}).when("/molecules/:name/edit",{templateUrl:"views/molecules/sketcher.html",controller:"MoleculeSketcherCtrl"}).when("/experiments/balldrop",{templateUrl:"views/experiments/balldrop.html",controller:"BallDropCtrl"}).when("/experiments/maze",{templateUrl:"views/experiments/maze.html",controller:"MazeCtrl"}).when("/experiments/marbles",{templateUrl:"views/experiments/marbles.html",controller:"MarblesCtrl"}).when("/mc2",{templateUrl:"views/mc2/mc2.html",controller:"Mc2Ctrl"}).when("/mc2/ballistics",{templateUrl:"views/mc2/ballistics.html",controller:"BallisticsCtrl"}).when("/mc2/spring",{templateUrl:"views/mc2/spring.html",controller:"SpringCtrl"}).when("/mc2/cloth",{templateUrl:"views/mc2/cloth.html",controller:"ClothCtrl"}).when("/mc2/collisions",{templateUrl:"views/mc2/collisions.html",controller:"CollisionsCtrl"}).when("/music",{templateUrl:"views/music/music.html",controller:"MusicCtrl"}).when("/music/tuner",{templateUrl:"views/music/tuner.html",controller:"TunerCtrl"}).when("/music/drumkit",{templateUrl:"views/music/drumkit.html",controller:"DrumkitCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("mctApp").controller("MainCtrl",["$scope","$location",function(a,b){a.$location=b,a.$watch("$location.path()",function(b){a.activeNavId=b||"/"}),a.getClass=function(b){return a.activeNavId?a.activeNavId.substring(0,b.length)===b?"active":"":void 0}}]),angular.module("mctApp").controller("AppCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("mctApp").factory("Post",["$resource",function(a){return a("posts/:name",{name:"@urlString"},{})}]),angular.module("mctApp").factory("Tag",["$resource",function(a){return a("tags/:name",{name:"@urlString"},{})}]),angular.module("mctApp").filter("tagFilter",function(){return function(a,b){function c(a){return function(b){a.push(b.name)}}if(b.length<1)return a;if(a.$resolved){var d=[];console.log(a.length);for(var e=0;e<b.length;e++)for(var f=b[e],g=0;g<a.length;g++){var h=a[g],i=[],j=c(i);h.tags.map(j),i.indexOf(f)>=0&&d.push(h)}return d}}}),angular.module("mctApp").controller("PostsCtrl",["$scope","$filter","Post","Tag",function(a,b,c,d){a.query="",a.selectedTags=[],a.posts=c.query(),a.tags=d.query(),a.getPosts=function(){return b("tagFilter")(a.posts,a.selectedTags)};var e=new Showdown.converter;a.getTagClass=function(b){var c=a.selectedTags.indexOf(b)>=0?"active":"";return c},a.toggleTag=function(b){var c=a.selectedTags.indexOf(b);c>=0?a.selectedTags.splice(c,1):a.selectedTags.push(b),console.log(a.selectedTags)},a.parseContent=function(a){return e.makeHtml(a)}}]),angular.module("mctApp").controller("NewPostCtrl",["$scope","$location","Post",function(a,b,c){a.post={title:"",tags:null,content:""},a.preview="";var d=new Showdown.converter;a.$watch("post.content",function(){a.post.content&&(a.preview=d.makeHtml(a.post.content))}),a.parseContent=function(b){b&&(a.preview=d.makeHtml(b))},a.savePost=function(){var d=new c(a.post);d.$save(),b.path("/posts")}}]),angular.module("mctApp").controller("EditPostCtrl",["$scope","$location","$routeParams","Post",function(a,b,c,d){a.post=d.get({name:c.name});var e=new Showdown.converter;a.$watch("post.content",function(){a.post.content&&(a.preview=e.makeHtml(a.post.content))}),a.savePost=function(){a.post.$save(),b.path("/posts")}}]),angular.module("mctApp").controller("ShowPostCtrl",["$scope","$location","$routeParams","Post",function(a,b,c,d){a.post=d.get({name:c.name});var e=new Showdown.converter;a.$watch("post.content",function(){a.post.content&&(a.content=e.makeHtml(a.post.content))}),a.editPost=function(){b.path("/posts/"+a.post.urlString+"/edit")},a.deletePost=function(){a.post.$delete(),b.path("/posts")}}]),angular.module("mctApp").factory("Molecule",["Atom","Bond",function(a,b){var c;return c=function(a,b,c){this.name=a,this.molFile=b,this.ctx=c,this.atoms=[],this.bonds=[],this.selection=[],this.selectedAtom=null,this.selectedBond=null,this.dirty=!1},c.prototype.copy=function(){var a=new c(this.name);a.atoms=this.atoms,a.bonds=this.bonds,console.log(a)},c.prototype.clearSelection=function(){for(var a=0;a<this.selection.length;a++){var b=this.selection[a];b.deselect()}this.selection.splice(0,this.selection.length)},c.prototype.changeSelection=function(a){this.clearSelection();for(var b=0;b<a.length;b++){var c=a[b];c.select(),this.selection.push(c)}},c.prototype.draw=function(){if(this.ctx){var a=this;this.ctx.clearRect(0,0,500,500),this.bonds.map(function(b){b.draw(a.ctx)}),this.atoms.map(function(b){b.draw(a.ctx)})}},c.prototype.findNearestObject=function(a,b,c){var d,e=this.findNearestAtom(a,b,c),f=this.findNearestBond(a,b,c);return d=e.distance<1.5*f.distance?{obj:e.atom,score:e.distance}:{obj:f.bond,score:f.distance}},c.prototype.findNearestAtom=function(a,b,c){for(var d,e=999,f=this.atoms.length,g=0;f>g;g++){var h=this.atoms[g],i=h.distanceFrom(a,b,c);e>i&&(e=i,d=h)}return{atom:d,distance:e}},c.prototype.findNearestBond=function(a,b,c){for(var d,e=999,f=this.bonds.length,g=0;f>g;g++){var h=this.bonds[g],i=h.distanceFrom(a,b,c);e>i&&(e=i,d=h)}return{bond:d,distance:e}},c.prototype.getBoundingBox=function(){var a=this.atoms.map(function(a){return{x:a.x,y:a.y,z:a.z,index:a.index}});a.sort(function(a,b){return a.x-b.x}),this.minX=a[0].x,this.maxX=a[a.length-1].x,a.sort(function(a,b){return a.y-b.y}),this.minY=a[0].y,this.maxY=a[a.length-1].y,a.sort(function(a,b){return a.z-b.z}),this.minZ=a[0].z,this.maxZ=a[a.length-1].z,this.width=this.maxX-this.minX,this.cx=this.minX+this.width/2,this.height=this.maxY-this.minY,this.cy=this.minY+this.height/2,this.depth=this.maxZ-this.minZ,console.log(this.depth),this.cz=this.minZ+this.depth/2,this.depth=0===this.depth?1:this.depth},c.prototype.getLines=function(){for(var a=[],b=0;b<this.bonds.length;b++){var c=this.bonds[b];a.push([c.startAtom.index,c.endAtom.index,1])}return a},c.prototype.getVertices=function(){this.getBoundingBox();for(var a=[],b=0;b<this.atoms.length;b++){var c=this.atoms[b],d={x:0,y:0,z:0};d.x=(c.x-this.cx)/this.width,d.x=d.x.toFixed(3),d.y=(c.y-this.cy)/this.height,d.y=d.y.toFixed(3),d.z=(c.z-this.cz)/this.depth,d.z=d.z.toFixed(3),d.z=d.z?d.z:1,a.push([d.x,d.y,d.z])}return a},c.prototype.normalize=function(){for(var a=0;a<this.atoms.length;a++){var b=this.atoms[a];b.x=b.x-(this.minX+this.width)/2,b.x=b.x/(1*this.width/2),b.x=b.x.toFixed(3),b.y=b.y-(this.minY+this.height)/2,b.y=b.y/(1*this.height/2),b.y=b.y.toFixed(3),b.z=b.z-(this.minZ+this.depth)/2,b.z=b.z/(1*this.depth/2),b.z=b.z?b.z:1,b.z=b.z.toFixed(3),b.z=1}},c.prototype.satisfy=function(a){var b;for(b=0;b<this.bonds.length;b++){var c=this.bonds[b];c.satisfy(a)}},c.prototype.addAtom=function(b,c,d,e){var f=new a(b,c,d,e,this);return this.draw(),this.dirty=!0,f},c.prototype.addBond=function(a,c,d){var e=new b(a,c,d,this);return this.draw(),e},c.prototype.generateMolFile=function(){var a=this.atoms.length,b=this.bonds.length,c=[];c.push(a+" "+b);for(var d=0;a>d;d++){var e=this.atoms[d];c.push([e.element,e.x,e.y,e.z].join(" "))}for(var f=0;b>f;f++){var g=this.bonds[f];c.push([g.startAtom.index,g.endAtom.index,g.order].join(" "))}var h=c.join("\n");return this.molFile=h,h},c.prototype.parseMolFile=function(){var c,d,e,f=this.molFile.split("\n"),g=f[0].split(" "),h=parseInt(g[0],10),i=parseInt(g[1],10);for(e=0;h>e;e++){c=f[e+1],d=c.split(" ");var j=d[0],k=parseFloat(d[1]),l=parseFloat(d[2]),m=parseFloat(d[3]);new a(j,k,l,m,this)}for(e=0;i>e;e++){c=f[e+h+1],d=c.split(" ");var n=parseInt(d[0],10),o=this.atoms[n],p=parseInt(d[1],10),q=this.atoms[p],r=parseInt(d[2],10);new b(o,q,r,this)}},c}]),angular.module("mctApp").factory("Atom",function(){var a;return a=function(a,b,c,d,e){this.element=a,this.x=b,this.y=c,this.z=d,this.molecule=e,this.molecule.atoms.push(this),this.index=this.molecule.atoms.indexOf(this),this.bonds=[]},a.prototype.select=function(){this.molecule.selectedAtom&&this.molecule.selectedAtom.deselect(),this.molecule.selectedAtom=this},a.prototype.deselect=function(){this.molecule.selectedAtom=!1},a.prototype.distanceFrom=function(a,b,c){var d=this.x-a,e=this.y-b,f=this.z-c,g=Math.sqrt(d*d+e*e+f*f);return g},a.prototype.change=function(){},a.prototype.draw=function(a){a.fillStyle="white",a.fillRect(this.x-5,this.y-5,15,12),a.fill(),a.beginPath(),a.fillStyle=this.molecule.selectedAtom===this?"red":"black",a.fillText(this.element,this.x-2,this.y+5),a.closePath(),a.fill()},a.prototype.bondTo=function(a){var b=this.molecule.addBond(this,a,1);return b},a.prototype.shift=function(a,b,c){this.x=this.x+a,this.y=this.y+b,this.z=this.z+c},a}),angular.module("mctApp").factory("Bond",function(){var a;return a=function(a,b,c,d){this.startAtom=a,this.startAtom.bonds.push(this),this.endAtom=b,this.endAtom.bonds.push(this),this.order=c,this.restLength=50,this.molecule=d,this.molecule.bonds.push(this),this.index=this.molecule.bonds.indexOf(this)},a.prototype.change=function(){this.order=this.order++%3+1,console.log(this.order)},a.prototype.length=function(){var a=this.endAtom.x-this.startAtom.x,b=this.endAtom.y-this.startAtom.y,c=this.endAtom.z-this.startAtom.z,d=Math.sqrt(a*a+b*b+c*c);return d},a.prototype.distanceFrom=function(a,b,c){var d=(this.startAtom.x-this.endAtom.x)/2+this.endAtom.x,e=(this.startAtom.y-this.endAtom.y)/2+this.endAtom.y,f=(this.startAtom.z-this.endAtom.z)/2+this.endAtom.z,g=d-a,h=e-b,i=f-c,j=Math.sqrt(g*g+h*h+i*i);return j},a.prototype.draw=function(a){a.beginPath(),a.strokeStyle=this.molecule.selectedBond===this?"red":"black";for(var b=1;b<=this.order;b++)a.moveTo(this.startAtom.x+(2*b-1),this.startAtom.y+2*b-1),a.lineTo(this.endAtom.x+2*b-1,this.endAtom.y+2*b-1);a.stroke()},a.prototype.select=function(){this.molecule.selectedBond&&this.molecule.selectedBond.deselect(),this.molecule.selectedBond=this},a.prototype.deselect=function(){this.molecule.selectedBond=!1},a.prototype.shift=function(){},a.prototype.satisfy=function(a){console.log(a)},a}),angular.module("mctApp").factory("MoleculeStore",["$resource",function(a){return a("molecules/:name",{name:"@urlString"})}]),angular.module("mctApp").factory("Renderer",function(){function a(a){if(!(a.length>0))return{x:[0,0],y:[0,0],z:[0,0]};for(var b=a[0][0],c=b,d=a[0][1],e=d,f=a[0][2],g=f,h=1;h<a.length;h++)return a[h][0]<b?b=a[h][0]:a[h][0]>c&&(c=a[h][0]),a[h][1]<d?b=a[h][1]:a[h][1]>e&&(c=a[h][1]),a[h][2]<f?b=a[h][2]:a[h][2]>g&&(c=a[h][2]),{x:[b,c],y:[d,e],z:[f,g]}}function b(a,b){for(var c=0;c<a.length;c++)a[c][0]*=b,a[c][1]*=b,a[c][2]*=b}function c(a,b,c){for(var d=a.length,e=Math.cos(c[0]),f=Math.sin(c[0]),g=0;d>g;g++)b[g][0]=a[g][0],b[g][1]=a[g][1]*e-a[g][2]*f,b[g][2]=a[g][1]*f+a[g][2]*e;e=Math.cos(c[1]),f=Math.sin(c[1]);var h,i;for(g=0;d>g;g++)h=b[g][0]*e-b[g][2]*f,i=b[g][0]*f+b[g][2]*e,b[g][0]=h,b[g][2]=i;for(e=Math.cos(c[2]),f=Math.sin(c[2]),g=0;d>g;g++)h=b[g][0]*e-b[g][1]*f,i=b[g][0]*f+b[g][1]*e,b[g][0]=h,b[g][1]=i}var d=function(b,c){this.molecule=b,this.canvas=document.getElementById(c),this.ctx=this.canvas.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height,this.bgColor="white",this.cx=this.width/2,this.cy=this.height/2,this.angles=[0,0,0],this.rotX=.01,this.rotY=.01,this.rotZ=.01,this.points=[],this.atoms=this.molecule.getVertices();for(var d=0;d<this.atoms.length;d++)this.points[d]=[],this.points[d][0]=this.atoms[d][0],this.points[d][1]=this.atoms[d][1],this.points[d][2]=this.atoms[d][2];this.lines=this.molecule.getLines(),this.bbox=a(this.points),this.minX=this.bbox.x[0],this.maxX=this.bbox.x[1],this.minY=this.bbox.y[0],this.maxY=this.bbox.y[1],this.minZ=this.bbox.z[0],this.maxZ=this.bbox.z[0],this.animationFrameId=0};return d.prototype.rescale=function(){b(this.points,.5),this.render()},d.prototype.rotate=function(){this.angles[0]+=this.rotX,this.angles[1]+=this.rotY,this.angles[2]+=this.rotZ,c(this.atoms,this.points,this.angles)},d.prototype.animate=function(){var a=this.animate.bind(this);this.rotate(),this.render(),this.animationFrameId=window.requestAnimationFrame(a)},d.prototype.rotateTo=function(a,b,d){this.angles=[a,b,d],c(this.atoms,this.points,this.angles),this.render()},d.prototype.convertPointToCanvas=function(a){var b={x:a[0]*this.width/2+this.cx,y:a[1]*this.height/2+this.cy};return b},d.prototype.render=function(){this.refreshBackground();var a=this.ctx;a.fillStyle="black";var b=this;this.points.forEach(function(c){var d=b.convertPointToCanvas(c);a.beginPath(),a.arc(d.x,d.y,8,0,6.28,0),a.fill()}),this.lines.forEach(function(c){var d=b.convertPointToCanvas(b.points[c[0]]),e=b.convertPointToCanvas(b.points[c[1]]);a.beginPath(),a.moveTo(d.x,d.y),a.lineTo(e.x,e.y),a.stroke()})},d.prototype.refreshBackground=function(){this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,this.width,this.height)},d.prototype.drawPoint=function(a,b,c,d){this.ctx.beginPath(),this.ctx.arc(a,b,d,0,6.28,0),this.ctx.fill()},d}),angular.module("mctApp").factory("MoleculeRenderer",function(){function a(a,b,c){return b>a?b:a>c?c:a}function b(a){if(!(a.length>0))return{x:[0,0],y:[0,0],z:[0,0]};for(var b=a[0][0],c=b,d=a[0][1],e=d,f=a[0][2],g=f,h=1;h<a.length;h++)return a[h][0]<b?b=a[h][0]:a[h][0]>c&&(c=a[h][0]),a[h][1]<d?b=a[h][1]:a[h][1]>e&&(c=a[h][1]),a[h][2]<f?b=a[h][2]:a[h][2]>g&&(c=a[h][2]),{x:[b,c],y:[d,e],z:[f,g]}}function c(a,b,c,d){for(var e=0;e<a.length;e++)a[e][0]+=b,a[e][1]+=c,a[e][2]+=d}function d(a,b){for(var c=0;c<a.length;c++)a[c][0]*=b,a[c][1]*=b,a[c][2]*=b}function e(a,b,c){for(var d=a.length,e=Math.cos([c[0]]),f=Math.sin([c[0]]),g=0;d>g;g++)b[g][0]=a[g][0],b[g][1]=a[g][1]*e-a[g][2]*f,b[g][2]=a[g][1]*f+a[g][2]*e;e=Math.cos(c[1]),f=Math.sin(c[1]);var h,i;for(g=0;d>g;g++)h=b[g][0]*e-b[g][2]*f,i=b[g][0]*f+b[g][2]*e,b[g][0]=h,b[g][2]=i;for(e=Math.cos(c[2]),f=Math.sin(c[2]),g=0;d>g;g++)h=b[g][0]*e-b[g][1]*f,i=b[g][0]*f+b[g][1]*e,b[g][0]=h,b[g][1]=i}function f(a,b,c,d){a.fillStyle=d,a.fillRect(0,0,b,c)}function g(a,b,c,d,e){a.beginPath(),a.arc(b,c,e,0,6.28,0),a.fill()}function h(a,b,c,d,e,f){a.font=2.4*f+"px Arial",a.fillText(b,c-.7*f,d+.7*f)}function i(a,b,c,d,e,f,g,h,i,j){if(a.beginPath(),a.moveTo(b,c),a.lineTo(e,f),a.closePath(),j){var k=a.createLinearGradient(b,c,e,f);k.addColorStop(0,h),k.addColorStop(1,i),a.strokeStyle=k}else a.strokeStyle=h;a.stroke()}function j(b,c,d,e,f,j,k,l,n,o,q,r,u,v,w,x,y,z,A){var B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb=.85;y&&(jb=1.2);for(var kb=[],lb=0;lb<j.length;lb++)kb.push([j[lb][2],0,lb]);for(lb=0;lb<k.length;lb++){var mb=.5*(j[k[lb][0]][2]+j[k[lb][1]][2]);kb.push([mb,1,lb,k[lb][2]])}for(kb.sort(function(a,b){return a[0]-b[0]}),lb=0;lb<kb.length;lb++)l&&0===kb[lb][1]&&(P=c+j[kb[lb][2]][0],Q=d+j[kb[lb][2]][1],P>=-v&&e+v>=P&&Q>=-v&&f+v>=Q?(R=j[kb[lb][2]][2],M=a(Math.round(255*(R-z)/A),0,255),u?(O=j[kb[lb][2]][3],E=O[0],F=O[1],G=O[2]):(E=s[0],F=s[1],G=s[2]),H=t[0],I=t[1],J=t[2],S=(255-M)/255,B=Math.round(E+S*(H-E)),C=Math.round(F+S*(I-F)),D=Math.round(G+S*(J-G)),y?(b.fillStyle="rgb("+B+","+C+","+D+")",h(b,j[kb[lb][2]][4],P,Q,R,.5*M/512*v)):w?(b.fillStyle="rgb("+B+","+C+","+D+")",g(b,P,Q,R,(.5+M/512)*v)):x?(db=(.5+M/512)*v,eb=2*db,cb=b.createRadialGradient(P-db+.34*eb,Q-db+.7*eb,.15*eb,P,Q,db),cb.addColorStop(0,"rgb("+B+","+D+","+C+")"),cb.addColorStop(.95,"rgba(0,0,0,1.0)"),cb.addColorStop(1,"rgba(0,0,0,0)"),b.fillStyle=cb,p?g(b,P,Q,R,(.5+M/512)*v):b.fillRect(P-db,Q-db,eb,eb)):($=1.5*v,m?(cb=b.createRadialGradient(P+$,Q+$,1,P,Q,v),cb.addColorStop(0,"rgb(0,0,0)"),cb.addColorStop(1,"rgb("+B+","+C+","+D+")")):(cb=b.createRadialGradient(P,Q,v,P+$,Q+$,1),cb.addColorStop(0,"rgb("+B+","+C+","+D+")"),cb.addColorStop(1,"rgb(0,0,0)")),b.fillStyle=cb,g(b,P,Q,R,(.5+M/512)*v))):n&&1===kb[lb][1]&&(T=j[k[kb[lb][2]][0]][0]+c,U=j[k[kb[lb][2]][0]][1]+d,V=j[k[kb[lb][2]][0]][2],W=j[k[kb[lb][2]][1]][0]+c,X=j[k[kb[lb][2]][1]][1]+d,Y=j[k[kb[lb][2]][1]][2],M=a(Math.round(255*(V-z)/A),0,255),N=a(Math.round(255*(Y-z)/A),0,255),q&&(b.lineWidth=.1+M/120),$=W-T,_=X-U,ab=Y-V,bb=Math.sqrt($*$+_*_+ab*ab),l&&(Z=jb*v*$/bb,T+=Z,W-=Z,Z=jb*v*_/bb,U+=Z,X-=Z),B=o[0],C=o[1],D=o[2],K="rgba("+B+","+C+","+D+","+M/255+")",L="rgba("+B+","+C+","+D+","+N/255+")",i(b,T,U,V,W,X,Y,K,L,r),kb[lb][3]>1&&(hb=.35*v,ib=Math.atan2(_,$)-1.5,fb=hb*Math.cos(ib),gb=hb*Math.sin(ib),l||(Z=.6*v*$/bb,T+=Z,W-=Z,Z=.6*v*_/bb,U+=Z,X-=Z),2===kb[lb][3]?i(b,T+fb,U+gb,V,W+fb,X+gb,Y,K,L,r):2===kb[lb][3]&&(i(b,T+fb,U+gb,V,W+fb,X+gb,Y,K,L,r),i(b,T-fb,U-gb,V,W-fb,X-gb,Y,K,L,r)))))}function k(a){this.mdiv=a.mdiv,this.canvas=document.getElementById(a.canvasId),this.ctx=this.canvas.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height,this.cx=this.width/2,this.cy=this.height/2,this.angles=[0,0,0],this.atoms=a.atoms,this.bonds=a.bonds,this.atomColors=s,this.bondsColor=r,this.autoRotation=[0,0,0],this.drawAtoms=a.drawAtoms||!0,this.drawBonds=a.drawBonds||!1,this.bondsAutoWidth=a.bondsAutoWidth||!0,this.bondsGradient=a.bondsGradient||!0,this.sphereShading=!0,this.render=function(){console.log(this.bonds),f(this.ctx,this.width,this.height,u),j(this.ctx,this.cx,this.cy,this.width,this.height,this.atoms,this.bonds,this.drawAtoms,this.drawBonds,this.bondsColor,this.bondsAutoWidth,this.bondsGradient,this.atomColors,this.atomRadius,this.flatShading,this.sphereShading,this.lettersShading,this.zBack,this.zRange),console.log(e()),console.log(m),console.log(n),console.log(q),console.log(e()),console.log(b()),console.log(c()),console.log(d())}}var l=navigator.userAgent.toLowerCase(),m=-1!==l.indexOf("opera"),n=-1!==l.indexOf("firefox")||-1!==l.indexOf("minefield"),o=-1!==l.indexOf("chrom"),p=-1!==l.indexOf("safari")&&!o,q=-1!==l.indexOf("os x")||-1!==l.indexOf("macintosh"),r=[100,100,100],s=[255,0,0],t=[255,255,255],u="rgb("+t[0]+","+t[1]+","+t[2]+")",v=function(a,b){var c=[];console.log(b);for(var d=0;d<a.length;d++){var e=a[d];c.push([parseFloat(e.x),parseFloat(e.y),parseFloat(e.z)])}this.molecule=new k({atoms:c,bonds:b,canvasId:"moleculeCanvas"}),this.molecule.render(),console.log(this.molecule)};return v}),angular.module("mctApp").controller("NewMoleculeCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("mctApp").controller("MoleculesCtrl",["$scope","MoleculeStore",function(a,b){a.molecules=b.query()}]),angular.module("mctApp").controller("ShowMoleculeCtrl",["$scope","$routeParams","Molecule","MoleculeStore","Renderer",function(a,b,c,d,e){a.moleculeName=b.name,b.name&&(a.moleculeStore=d.get({name:b.name},function(b){b.molFile&&(a.molecule=new c(b.name,b.molFile,a.ctx),a.name=a.molecule.name,a.molecule.parseMolFile(),a.renderer=new e(a.molecule,"moleculeCanvas"),a.renderer.animate())}))}]),angular.module("mctApp").controller("EditMoleculeCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("mctApp").controller("MoleculeSketcherCtrl",["$scope","$filter","$location","$routeParams","Molecule","MoleculeStore",function(a,b,c,d,e,f){a.canvas=document.getElementById("chem-sketcher"),a.div=angular.element(document.getElementById("chem-sketcher")),a.ctx=a.canvas.getContext("2d"),d.name?a.moleculeStore=f.get({name:d.name},function(b){a.molecule=new e(b.name,b.molFile,a.ctx),a.name=a.molecule.name,a.molecule.parseMolFile(),a.molecule.draw()}):a.molecule=new e(!1,!1,a.ctx),a.dragging=!1,a.atomTool="C",a.bondTool="1",a.mouseTool=!1,a.mouseTools=["select","group","delete"],a.bondTypes=["1","2","3","d","s"],a.atoms=["C","H","N","O","P","S","B","Si","F","Cl","Br","I"],a.atomGroups=b("groupBy")(a.atoms,6),a.getVertices=function(){var b=a.molecule.getVertices();console.log(b)},a.handleMouseDown=function(b){var c=b.offsetX,d=b.offsetY,e=a.molecule;if(a.mouseTool&&"select"===a.mouseTool){var f=e.findNearestObject(c,d,0);e.changeSelection([f.obj]),a.dragging=!0,a.dragStart={x:c,y:d},e.draw()}},a.handleMouseMove=function(b){var c=b.offsetX,d=b.offsetY,e=a.molecule;if(a.dragging){var f=c-a.dragStart.x,g=d-a.dragStart.y;e.selection.map(function(b){b.shift(f,g,0),a.dragStart.x=c,a.dragStart.y=d}),e.draw()}},a.handleMouseUp=function(b){var c=b.offsetX,d=b.offsetY,e=a.molecule;a.dragging&&(a.dragging=!1);var f=e.findNearestObject(c,d,0);if(a.mouseTool)a.molecule.selection.indexOf(f.obj)>=0&&f.obj.change(),e.changeSelection([f.obj]);else if(a.atomTool&&a.bondTool){var g;g=f.score<15?f.obj:e.addAtom(a.atomTool,c,d,0),e.selectedAtom&&e.selectedAtom.distanceFrom(c,d,0)<75&&e.selectedAtom.bondTo(g),e.changeSelection([g])}e.draw()},a.div.on("mousedown",a.handleMouseDown),a.div.on("mousemove",a.handleMouseMove),a.div.on("mouseup",a.handleMouseUp),a.satisfy=function(){a.molecule.satisfy(.1)},a.changeAtomTool=function(b){a.atomTool=b,a.bondTool=a.bondTool?a.bondTool:"1",a.mouseTool=!1},a.getAtomToolClass=function(b){var c=a.atomTool===b?"active":"";return c},a.changeMouseTool=function(b){a.mouseTool=b,a.atomTool=!1,a.bondTool=!1},a.getMouseToolClass=function(b){var c=a.mouseTool===b?"active":"";return c},a.changeBondTool=function(b){a.bondTool=b,a.mouseTool=!1,a.atomTool=a.atomTool?a.atomTool:"C"},a.getBondToolClass=function(b){var c=a.bondTool===b?"active":"";return c},a.generateMolFile=function(){var b=a.molecule.generateMolFile();console.log(b)},a.saveMolecule=function(){var b=a.molecule.generateMolFile();if(a.moleculeStore)a.moleculeStore.molFile=b,a.moleculeStore.$save();else{var d=new f({name:a.name,molFile:b});d.$save()}c.path("/chemistry/molecules")}}]),angular.module("mctApp").filter("groupBy",function(){return function(a,b){for(var c,d=[],e=0;e<a.length;e++)e%b===0&&(c=[],d.push(c)),c.push(a[e]);return d}}),angular.module("mctApp").factory("BallDrop",function(){function a(a){return void 0!==a.axis||0!==a.overlap}function b(a,b){for(var c,d,e,f=1e4,g=0;g<a.points.length;g++)d=a.points[g],c=Math.sqrt(Math.pow(d.x-b.current.x,2)+Math.pow(d.y-b.current.y,2)),f>c&&(f=c,e=d);return e}function c(a,b){var c=a.minimumTranslationVector(a.getAxes(),b),d=a.minimumTranslationVector(b.getAxes(),b);return 0===c.overlap&&0===d.overlap?{axis:void 0,overlap:0}:c.overlap<d.overlap?c:d}function d(a,b){var c=Math.sqrt(Math.pow(b.current.x-a.current.x,2)+Math.pow(b.current.y-a.current.y,2)),d=Math.abs(a.radius+b.radius)-c;return 0>d?new l(void 0,0):new l(void 0,d)}function e(a,c){var d=a.getAxes(),e=b(a,c),f=new k(c.current.x,c.current.y),g=new k(e.x,e.y);return d.push(f.subtract(g).normalize()),a.minimumTranslationVector(d,c)}var f,g,h,i,j,k,l;return k=function(a,b){this.x=a,this.y=b},k.prototype={getMagnitude:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},add:function(a){var b=new k;return b.x=this.x+a.x,b.y=this.y+a.y,b},subtract:function(a){var b=new k;return b.x=this.x-a.x,b.y=this.y-a.y,b},multiply:function(a){var b=new k;return b.x=this.x*a,b.y=this.y*a,b},dot:function(a){return this.x*a.x+this.y*a.y},edge:function(a){return this.subtract(a)},perpendicular:function(){var a=new k;return a.x=this.y,a.y=0-this.x,a},normalize:function(){var a=new k(0,0),b=this.getMagnitude();return 0!==b&&(a.x=this.x/b,a.y=this.y/b),a},normal:function(){var a=this.perpendicular();return a.normalize()},dup:function(){return new k(this.x,this.y)},zero:function(){return this.x=0,this.y=0,this}},f=function(a){this.canvas=a,this.canvas.width=800,this.canvas.height=500,this.ctx=a.getContext("2d"),this.width=a.width,this.height=a.height,this.ball=new g,this.shapes=[],this.animFrame=window.requestAnimationFrame(this.update.bind(this))},f.prototype.startNewLine=function(a,b){var c=new h(a,b);return this.shapes.push(c),c},f.prototype.removeLine=function(a){this.shapes.indexOf(a),this.shapes.splice(a)},f.prototype.refreshBackground=function(){this.ctx.clearRect(0,0,800,500)},f.prototype.render=function(){this.refreshBackground(),this.detectCollisions();var a=this.ctx;this.ball.draw(a),this.shapes.map(function(b){b.draw(a)})},f.prototype.detectCollisions=function(){var b,c,d,e=this.shapes.length;for(c=0;e>c;c++)b=this.shapes[c],d=b.collidesWith(this.ball),a(d)?(this.ball.bounce(d,b),b.color="red",this.ball.color="red"):(b.color="black",this.ball.color="black")},f.prototype.reset=function(){this.ball.reset(),this.shapes.forEach(function(a){a.reset()})},f.prototype.update=function(){this.ball.acceleration.y+=10,this.ball.integrate(.04),this.ball.current.y>this.height&&this.reset(),this.render(),this.animFrame=window.requestAnimationFrame(this.update.bind(this))},i=function(a,b){this.min=a,this.max=b},i.prototype.overlaps=function(a){return this.max>a.min&&a.max>this.min},i.prototype.getOverlap=function(a){var b;return this.overlaps(a)?b=this.max>a.max?a.max-this.min:this.max-a.min:0},l=function(a,b){this.axis=a,this.overlap=b},j=function(){this.radius=void 0},j.prototype.separationOnAxes=function(a,b){var c,d,e,f;for(c=0;c<a.length;c++)if(d=a[c],e=b.project(d),f=this.project(d),!e.overlaps(f))return!0},j.prototype.minimumTranslationVector=function(a,b){for(var c,d,e,f,g,h=1e4,i=0;i<a.length;i++){if(e=a[i],f=b.project(e),g=this.project(e),c=f.getOverlap(g),0===c)return{axis:void 0,overlap:0};h>c&&(h=c,d=e)}return{axis:d,overlap:h}},g=function(){this.reset(),this.radius=5},g.prototype=new j,g.prototype.reset=function(){this.current=new k(50,10),this.previous=new k(50,10),this.velocity=new k(0,0),this.acceleration=new k(0,5),this.color="black"},g.prototype.integrate=function(a){var b=this.current.multiply(2).subtract(this.previous).add(this.acceleration.multiply(a*a));this.previous=this.current.dup(),this.current=b,this.acceleration.zero()},g.prototype.separate=function(a){var b,c,d,e;void 0===a.axis&&(e=new k,d=Math.sqrt(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2)),e.x=this.velocity.x/d,e.y=this.velocity.x/d,a.axis=new k(e)),b=a.axis.y*a.overlap,c=a.axis.y*a.overlap,(0>b&&this.velocity.x<0||b>0&&this.velocity.x>0)&&(b=-b),(0>c&&this.velocity.y<0||c>0&&this.velocity.y>0)&&(c=-c),this.move(b,c)},g.prototype.checkMTVAxisDirection=function(a,b){if(void 0!==a.axis){var c=this.current.dup(),d=b.centroid(),e=d.subtract(c);e.normalize(),e.dot(a.axis)>0&&(a.axis.x=-a.axis.x,a.axis.y=-a.axis.y)}},g.prototype.bounce=function(a,b){this.checkMTVAxisDirection(a,b);var c,d,e,f=this.velocity.normalize(),g=this.velocity.getMagnitude(),h=new k;c=void 0!==a.axis?a.axis.perpendicular():new k(-f.y,f.x),d=f.dot(c),e=c.dot(c);var i=d/e;h.x=2*i*c.x-f.x,h.y=2*i*c.y-f.y,this.separate(a),this.velocity.x=h.x*g,this.velocity.y=h.y*g},g.prototype.move=function(a,b){this.previous=this.current.dup(),this.current.x+=a,this.current.y+=b},g.prototype.draw=function(a){a.fillStyle=this.color,a.beginPath(),a.arc(this.current.x,this.current.y,this.radius,0,6.28,0),a.fill()},g.prototype.project=function(a){var b=[],c=this.current.dot(a);return b.push(c),b.push(c+this.radius),b.push(c-this.radius),new i(Math.min.apply(Math,b),Math.max.apply(Math,b))},g.prototype.collidesWith=function(a){return void 0===a.radius?e(a,this):d(this,a)},g.prototype.getAxes=function(){return[]},h=function(a,b){this.start=new k(a,b),this.end=new k(a+1,b+1),this.points=[this.start,this.end],this.reset()},h.prototype=new j,h.prototype.centroid=function(){var a=this.length();return new k(this.start.x+a/2,this.start.y+a/2)},h.prototype.reset=function(){this.color="black"},h.prototype.project=function(a){var b=new k,c=[];return this.points.forEach(function(d){b.x=d.x,b.y=d.y,c.push(b.dot(a))}),new i(Math.min.apply(Math,c),Math.max.apply(Math,c))},h.prototype.collidesWith=function(a){return void 0!==a.radius?e(this,a):c(this,a)},h.prototype.getAxes=function(){var a=[];return a.push(this.start.edge(this.end).normal()),a.push(new k(0,1)),a.push(new k(1,0)),a},h.prototype.draw=function(a){a.beginPath(),a.lineWidth=2,a.strokeStyle=this.color,a.moveTo(this.start.x,this.start.y),a.lineTo(this.end.x,this.end.y),a.closePath(),a.stroke()},h.prototype.length=function(){var a=this.end.subtract(this.start);return a.normalize()},f}),angular.module("mctApp").factory("Maze",function(){var a=function(a,b){this.path=a,this.cell=b,this.cell.isBranchPoint=!0,this.branches=[]};a.prototype.getChoices=function(){var a=this.path.history;return this.branches.filter(function(b){return a.indexOf(b)<0})};var b=function(a,b){this.maze=a,this.start=b,this.history=[],this.branchPoints=[],this.cell=b;var c=this.choosePath();this.travelTo(c)};b.prototype.choosePath=function(){var b,c=[];if(this.cell.left&&(b=this.maze.findCell(this.cell.column-1,this.cell.row),this.history.indexOf(b)<0&&c.push(b)),this.cell.right&&(b=this.maze.findCell(this.cell.column+1,this.cell.row),this.history.indexOf(b)<0&&c.push(b)),this.cell.top&&(b=this.maze.findCell(this.cell.column,this.cell.row-1),this.history.indexOf(b)<0&&c.push(b)),this.cell.bottom&&(b=this.maze.findCell(this.cell.column,this.cell.row+1),this.history.indexOf(b)<0&&c.push(b)),c.length>1){var d=new a(this,this.cell);d.branches=c,this.branchPoints.push(d)}var e=c[Math.floor(Math.random()*c.length)];return e},b.prototype.travelTo=function(a){if(this.maze.solveInProgress){if(a===this.maze.end)return window.alert("Win"),this.maze.solveInProgress=!1,void 0;if(!a)for(var b=this.branchPoints[this.branchPoints.length-1],c=1;b;){if(b.getChoices().length>0)return this.maze.draw(),this.travelTo(b.cell),void 0;if(b=this.branchPoints[this.branchPoints.length-c],c>this.branchPoints.length)return window.alert("No solution found"),this.maze.solveInProgress=!1,!1;c++}this.history.push(this.cell),this.cell=a,this.cell.visited=!0;var d=this;this.maze.draw(),window.setTimeout(function(){d.travelTo(d.choosePath())},100)}};var c=function(a,b,c){this.rows=c,this.columns=b,this.defaultFill="lightsteelblue",this.startFill="lightgreen",this.endFill="red",this.branchPointFill="green",this.visitedFill="white",a&&(this.canvas=a,this.ctx=this.canvas.getContext("2d"),this.height=a.height,this.width=a.width),this.reset()};c.prototype.solve=function(){this.solveInProgress||(this.reset(),this.solveInProgress=!0,new b(this,this.start))},c.prototype.stop=function(){this.solveInProgress=!1},c.prototype.getIndex=function(a,b){return a+b*this.columns},c.prototype.findCell=function(a,b){return this.cells[a+b*this.columns]},c.prototype.generateConfig=function(){if(!this.end||!this.start)return console.log("incomplete maze"),void 0;this.changed=!1;var a=this.cells.map(function(a){return{row:a.row,column:a.column,left:a.left,right:a.right,top:a.top,bottom:a.bottom}}),b={rows:this.rows,columns:this.columns,start:{column:this.start.column,row:this.start.row},end:{column:this.end.column,row:this.end.row},cells:a};return this.loadData=b,JSON.stringify(b)},c.prototype.load=function(a){this.solveInProgress=!1,this.loadData=a,console.log(a),this.columns=a.columns,this.rows=a.rows,this.cells=new Array(this.rows*this.columns),this.cellWidth=this.canvas.width/this.columns,this.cellHeight=this.canvas.height/this.rows;var b,c=this;a.cells.forEach(function(a){b=c.addCell(a.column,a.row),b.maze=c,b.top=a.top,b.bottom=a.bottom,b.left=a.left,b.right=a.right,c.cells[c.getIndex(a.column,a.row)]=b}),this.start=this.findCell(a.start.column,a.start.row),this.end=this.findCell(a.end.column,a.end.row),this.draw()},c.prototype.reset=function(){if(this.changed)return window.alert("Reset will destroy new data"),!1;if(this.loadData)return this.load(this.loadData),void 0;var a,b,c;for(this.cellWidth=this.canvas.width/this.columns,this.cellHeight=this.canvas.height/this.rows,this.cells=new Array(this.rows*this.columns),console.log(this.columns),console.log(this.rows),a=0;a<this.rows;a++)for(b=0;b<this.columns;b++)c=this.addCell(b,a);
this.draw()},c.prototype.addCell=function(a,b){var c=new d(a,b);return c.maze=this,this.cells[this.getIndex(a,b)]=c,c},c.prototype.draw=function(){if(this.canvas){var a=this.ctx;a.clearRect(0,0,this.width,this.height),this.cells.forEach(function(b){b.draw(a)})}};var d=function(a,b){this.column=a,this.row=b,this.fill="lightsteelblue",this.left=!1,this.right=!1,this.top=!1,this.bottom=!1};return d.prototype.removeWall=function(a){this.maze.changed=!0;var b,c=this.maze;if("left"===a){if(this.column-1<0)return;b=c.findCell(this.column-1,this.row),b&&(this.left=this.left?!1:!0,b.right=b.right?!1:!0)}if("right"===a){if(this.column+1>=c.columns)return;b=c.findCell(this.column+1,this.row),b&&(this.right=this.right?!1:!0,b.left=b.left?!1:!0)}if("top"===a){if(this.row-1<0)return;b=c.findCell(this.column,this.row-1),b&&(this.top=this.top?!1:!0,b.bottom=b.bottom?!1:!0)}if("bottom"===a){if(this.row+1>=c.rows)return;b=c.findCell(this.column,this.row+1),console.log(b),b&&(this.bottom=this.bottom?!1:!0,b.top=b.top?!1:!0)}console.log(this)},d.prototype.draw=function(a){a.lineWidth=1;var b=this.maze.cellWidth,c=this.maze.cellHeight;a.fillStyle=this.maze.start===this?this.maze.startFill:this.maze.end===this?this.maze.endFill:this.isBranchPoint?this.maze.branchPointFill:this.visited?this.maze.visitedFill:this.fill,a.beginPath(),a.fillRect(this.column*b,this.row*c,b,c),a.closePath(),this.left||(a.strokeStyle=this.leftColor,a.beginPath(),a.moveTo(this.column*b,this.row*c),a.lineTo(this.column*b,(this.row+1)*c),a.closePath(),a.stroke()),this.right||(a.strokeStyle=this.rightColor,a.beginPath(),a.moveTo((this.column+1)*b,this.row*c),a.lineTo((this.column+1)*b,(this.row+1)*c),a.closePath(),a.stroke()),this.top||(a.strokeStyle=this.topColor,a.beginPath(),a.moveTo(this.column*b,this.row*c),a.lineTo((this.column+1)*b,this.row*c),a.closePath(),a.stroke()),this.bottom||(a.strokeStyle=this.bottomColor,a.beginPath(),a.moveTo(this.column*b,(this.row+1)*c),a.lineTo((this.column+1)*b,(this.row+1)*c),a.closePath(),a.stroke())},c}),angular.module("mctApp").factory("MazeStore",["$resource",function(a){return a("mazes/:name",{name:"@urlString"})}]),angular.module("mctApp").controller("BallDropCtrl",["$scope",function(a){a.greeting="Hello"}]),angular.module("mctApp").controller("MazeCtrl",["$scope","Maze","MazeStore",function(a,b,c){a.rows=10,a.columns=10,a.mazes=c.query(),a.init=function(){var c=angular.element(document.getElementById("maze-canvas"))[0];c.width=700,c.height=700,a.maze=new b(c,a.columns,a.rows),a.canvas=c},a.deleteMaze=function(b){var d=window.confirm("Delete maze: "+b.name);return d?(b.$delete(),a.mazes=c.query(),!1):void 0},a.activeMaze=function(b){return b===a.mazeStore?"active":""},a.saveMaze=function(){var b=a.maze.generateConfig();if(b){if(a.mazeStore)a.mazeStore.config=b,a.mazeStore.$save();else{var d=new c({name:a.name,config:b});d.$save()}a.mazes=c.query()}},a.loadMaze=function(b){a.mazeStore=b,a.name=b.name;var c=JSON.parse(b.config);a.maze.load(c),a.columns=a.maze.columns,a.rows=a.maze.rows},a.solve=function(){a.maze.solve()},a.stop=function(){a.maze.stop()},a.handleMouseDown=function(b){var c=a.maze.cellWidth,d=a.maze.cellHeight,e=Math.floor((b.offsetX-1)/c),f=Math.floor((b.offsetY-1)/d),g=a.maze.findCell(e,f);if(a.maze.startSelection)return a.maze.startSelection=!1,void 0;if(a.maze.endSelection)return a.maze.endSelection=!1,void 0;var h=b.offsetX-g.column*c,i=(g.column+1)*c-b.offsetX,j=b.offsetY-g.row*d,k=(g.row+1)*d-b.offsetY,l={left:h,right:i,top:j,bottom:k},m=a.findLowestDelta(l);g.removeWall(m),a.maze.draw()},a.handleMouseMove=function(b){var c=a.maze.cellWidth,d=a.maze.cellHeight,e=Math.floor(b.offsetX/c),f=Math.floor(b.offsetY/d),g=a.maze.findCell(e,f);a.maze.startSelection&&(a.maze.start=g),a.maze.endSelection&&(a.maze.end=g),a.maze.draw()},a.addStart=function(){a.maze.startSelection=!0},a.addEnd=function(){a.maze.endSelection=!0},a.findLowestDelta=function(a){var b=Object.keys(a).reduce(function(b,c){var d=a[c];return d<a[b]?c:b});return b}}]),angular.module("mctApp").controller("MarblesCtrl",["$scope",function(a){function b(b,c){return b+c*a.maxColumn}a.canvas=angular.element(document.getElementById("marbles-canvas"))[0],a.ctx=a.canvas.getContext("2d"),a.canvas.width=600,a.canvas.height=600;var c=40,d=["red","green","blue"],e=function(a,b,e){this.column=a,this.row=b,this.type=e,this.fill=d[e],this.hidden=!1,this.radius=c/2};e.prototype.hide=function(){this.hidden=!0},e.prototype.draw=function(a){this.hidden||(a.beginPath(),a.fillStyle=this.fill,a.arc((this.column+.5)*c,(this.row+.5)*c,this.radius,0,6.28,0),a.fill(),a.closePath())};var f=function(){this.reset()};f.prototype.reset=function(){var d,f,g,h;for(this.maxRow=Math.floor(a.canvas.height/c),this.maxColumn=Math.floor(a.canvas.width/c),a.maxColumn=this.maxColumn,this.maxIndex=this.maxRow*this.maxColumn,this.board=new Array(this.maxIndex),this.score=0,this.neighborsFound=0,this.neighborsBoard=null,d=0;d<this.maxColumn;d++)for(f=0;f<this.maxRow;f++)h=Math.floor(3*Math.random()),g=new e(d,f,h),this.board[b(d,f)]=g},f.prototype.findNeighbors=function(a,c,d){if(!(a>=this.maxColumn||0>a||c>=this.maxRow||0>c)&&this.board[b(a,c)]){var e=!1;-1===d&&(e=!0,d=this.board[b(a,c)].type,this.neighborsFound=0,this.neighborsBoard=new Array(this.maxIndex)),1===this.neighborsBoard[b(a,c)]||!e&&d!==this.board[b(a,c)].type||(this.neighborsBoard[b(a,c)]=1,this.findNeighbors(a+1,c,d),this.findNeighbors(a-1,c,d),this.findNeighbors(a,c+1,d),this.findNeighbors(a,c-1,d),(e!==!0||0!==this.neighborsFound)&&(this.board[b(a,c)].hide(),this.board[b(a,c)]=null,this.neighborsFound+=1,console.log(this.neighborsFound)))}},f.prototype.shift=function(){var a,c,d,e;for(a=0;a<this.maxColumn;a++)for(e=0,c=this.maxRow-1;c>=0;c--)this.board[b(a,c)]?e>0&&(d=this.board[b(a,c)],d.row+=e,this.board[b(a,c+e)]=d,this.board[b(a,c)]=null):e+=1;for(e=0,a=0;a<this.maxColumn;a++)if(this.board[b(a,this.maxRow-1)]){if(e>0)for(c=0;c<this.maxRow;c++)d=this.board[b(a,c)],d&&(d.column-=e,this.board[b(a-e,c)]=d,this.board[b(a,c)]=null)}else e+=1},f.prototype.victoryCheck=function(){for(var a=!0,c=this.maxColumn-1;c>=0;c--)this.board[b(c,this.maxRow-1)]&&(a=!1);a&&(this.score+=500),(a||!this.checkNeighbors(0,this.maxRow-1,-1))&&window.alert("Game over")},f.prototype.checkNeighbors=function(a,c,d){if(a>=this.maxColumn||0>a||c>=this.maxRow||0>c)return!1;if(!this.board[b(a,c)])return!1;var e=this.board[b(a,c)].type;return d===e?!0:this.checkNeighbors(a+1,c,e)||this.checkNeighbors(a,c-1,this.board[b(a,c)].type)},a.newGame=function(){a.game=new f,g()};var g=function(){a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height),a.game.board.forEach(function(b){b&&b.draw(a.ctx)})};a.handleClick=function(b){var d=Math.floor(b.offsetX/c),e=Math.floor(b.offsetY/c),f=a.game;f.findNeighbors(d,e,-1),f.score+=(f.neighborsFound-1)*(f.neighborsFound-1),f.shift(),f.victoryCheck(),g()}}]),angular.module("mctApp").directive("balldrop",["BallDrop",function(a){return{templateUrl:"templates/balldrop.html",restrict:"E",replace:!0,link:function(b,c){b.canvas=c[0],b.balldrop=new a(b.canvas),b.handleMouseDown=function(a){var c=a.offsetX,d=a.offsetY;b.line=b.balldrop.startNewLine(c,d)},b.handleMouseMove=function(a){if(b.line){var c=a.offsetX,d=a.offsetY;b.line.end.x=c,b.line.end.y=d,b.balldrop.render()}},b.handleMouseUp=function(){b.line=null}}}}]),angular.module("mctApp").controller("Mc2Ctrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("mctApp").factory("Vector3",function(){var a=function(a,b,c){this.x=a,this.y=b,this.z=c};return a.prototype.mul=function(b){var c=this.x*b,d=this.y*b,e=this.z*b;return new a(c,d,e)},a.prototype.imul=function(a){return this.x*=a,this.y*=a,this.z*=a,this},a.prototype.div=function(b){var c=this.x/b,d=this.y/b,e=this.z/b;return new a(c,d,e)},a.prototype.idiv=function(a){return this.x/=a,this.y/=a,this.z/=a,this},a.prototype.add=function(b){var c=this.x+b.x,d=this.y+b.y,e=this.z+b.z;return new a(c,d,e)},a.prototype.iadd=function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},a.prototype.sub=function(b){var c=this.x-b.x,d=this.y-b.y,e=this.z-b.z;return new a(c,d,e)},a.prototype.isub=function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},a.prototype.dot=function(a){var b=this.x*a.x+this.y*a.y+this.z*a.z;return b},a.prototype.cross=function(b){var c=this.y*b.z-this.z*b.y,d=this.z*b.x-this.x*b.z,e=this.x*b.y-this.y*b.x;return new a(c,d,e)},a.prototype.getMagnitude=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return a},a.prototype.squaredLength=function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;return a},a.prototype.normalize=function(){var b=this.getMagnitude();return new a(this.x/b,this.y/b,this.z/b)},a.prototype.zero=function(){return this.x=0,this.y=0,this.z=0,this},a}),angular.module("mctApp").factory("World",["Particle","Spring","Gravity","Boundary",function(a,b,c,d){var e=function(){this.particles=[],this.forceRegistry=[],this.gravity=null,this.damping=.01,this.preserveImpulse=!0};return e.prototype.addParticle=function(b,c,d,e){var f=new a(this,b,c,d,e);return this.particles.push(f),f},e.prototype.addGravity=function(a,b,d){this.gravity=new c(a,b,d)},e.prototype.addSpringForceGenerator=function(a,c,d,e){var f=new b(a,c,d,e);return this.registerForceGenerator(f),f},e.prototype.registerForceGenerator=function(a){return this.forceRegistry.push(a),a},e.prototype.addBoundaries=function(a){this.boundary=new d(a)},e.prototype.detectCollisions=function(a){var b,c,d,e,f,g=20;for(b=0;b<this.particles.length;++b)if(c=this.particles[b],a!==c&&(d=a.getCurrent().sub(c.getCurrent()),e=d.getMagnitude(),f=e*e,g>e)){var h=(e-g)/e;a.velocity,c.velocity,this.preserveImpulse,a.addForce(d.mul(h*-.5)),c.addForce(d.mul(.5*h))}},e.prototype.simulate=function(a){var b=this.gravity,c=this.damping,d=this.boundary,e=this.detectCollisions.bind(this);this.forceRegistry.forEach(function(b){b.update(a)}),this.particles.forEach(function(f){f.isSelected||(b&&f.addForce(b.acceleration),d&&d.checkParticle(f),e(f),f.integrate(a,c))})},e}]),angular.module("mctApp").factory("Particle",["Vector3",function(a){var b=function(b,c,d,e,f){this.world=b,this.current=new a(c,d,e),this.previous=new a(c,d,e),this.velocity=new a(0,0,0),this.acceleration=new a(0,0,0),this.damping=0,this.forceAccumulator=new a(0,0,0),this.mass=void 0===f?1:f,this.inverseMass=0===this.mass?0:1/this.mass};return b.prototype.bounce=function(b){var c=this.velocity.x*b.x,d=this.velocity.y*b.y,e=this.velocity.z*b.z,f=new a(c,d,e),g=this.current.add(f);this.previous=this.current,this.current=g},b.prototype.integrate=function(a){var b=this.damping;if(0!==this.inverseMass){this.acceleration.iadd(this.forceAccumulator.mul(this.inverseMass*a*a)),this.velocity=this.current.mul(1-b).sub(this.previous.mul(1-b)).add(this.acceleration);var c=this.current.add(this.velocity);this.previous=this.current,this.current=c,this.clearAccumulator()}},b.prototype.getCurrent=function(){return this.current},b.prototype.shift=function(b,c,d){var e=new a(b,c,d),f=this.current.add(e);this.previous=this.current,this.current=f},b.prototype.moveTo=function(b,c,d){var e=new a(b,c,d);this.previous=this.current,this.current=e},b.prototype.addForce=function(a){this.forceAccumulator.iadd(a)},b.prototype.accelerate=function(b,c,d){var e=new a(b,c,d);this.addForce(e)},b.prototype.clearAccumulator=function(){this.acceleration.zero(),this.forceAccumulator.zero()},b}]),angular.module("mctApp").factory("Gravity",["Vector3",function(a){var b=function(b,c,d){this.acceleration=new a(b,c,d)};return b}]),angular.module("mctApp").factory("Spring",function(){var a=function(a,b,c,d){this.p1=a,this.p2=b,this.rest=void 0===d?b.getCurrent().sub(a.getCurrent()).getMagnitude():d,this.sqRest=this.rest*this.rest,this.k=c};return a.prototype.getLength=function(){var a=this.p1.getCurrent().sub(this.p2.getCurrent()).getMagnitude();return a},a.prototype.getDirection=function(){var a=this.p2.getCurrent().sub(this.p1.getCurrent()).normalize();return a},a.prototype.update=function(){var a=this.getLength(),b=this.getDirection(),c=this.p2.getCurrent().sub(this.p1.getCurrent()),d=c.squaredLength(),e=(d-this.sqRest)/((this.sqRest+d)*(this.p1.inverseMass+this.p2.inverseMass))*this.k;(a-this.rest)/this.rest*this.k,this.p1.addForce(b.mul(.5*e)),this.p2.addForce(b.mul(e*-.5))},a}),angular.module("mctApp").factory("Boundary",["Vector3",function(a){var b=function(a){this.minX=a.x,this.maxX=a.x+a.width,this.minY=a.y,this.maxY=a.y+a.height};return b.prototype.checkPosition=function(a){return a.x<this.minX||a.x>this.maxX||a.y<this.minY||a.y>this.maxY?!1:!0},b.prototype.getCorrection=function(a){var b=0,c=0;return a.x<this.minX&&(b=this.minX-a.x),a.x>this.maxX&&(b=this.maxX-a.x),a.y<this.minY&&(c=this.minY-a.y),a.y>this.maxY&&(c=this.maxY-a.y),{x:b,y:c}},b.prototype.checkParticle=function(b){var c,d=b.getCurrent();this.checkPosition(d)||(this.getCorrection(d),(d.x<this.minX||d.x>this.maxX)&&(c=new a(-1,1,1)),(d.y<this.minY||d.y>this.maxY)&&(c=new a(1,-1,1)),b.bounce(c))},b}]),angular.module("mctApp").controller("BallisticsCtrl",["$scope","Particle","Vector3",function(a,b,c){function d(){a.ctx.clearRect(0,0,800,500),a.ctx.fillStyle="red",a.ctx.fillRect(a.position.x-5,a.position.y-5,10,10)}function e(){d(),a.ball.update(.3),a.animFrame=window.requestAnimationFrame(e)}a.canvas=angular.element(document.getElementById("ballistics-demo"))[0],a.canvas.width=800,a.canvas.height=500,a.ctx=a.canvas.getContext("2d"),a.ctx.fillStyle="#ddd",a.ctx.fillRect(0,0,800,500),a.position={x:10,y:400},a.acceleration={x:30,y:-40},a.gravity={x:0,y:1},a.animFrame=null;var f=function(){this.reset(),d(),this.draw(a.ctx)};f.prototype.reset=function(){this.particle=new b("world",a.position.x,a.position.y),this.particle.addForce(new c(a.acceleration.x,a.acceleration.y,0))},f.prototype.checkBounds=function(){return this.particle.current.x<0||this.particle.current.x>800||this.particle.current.y<0||this.particle.current.y>500?(this.reset(),!0):!1},f.prototype.update=function(b){this.checkBounds()&&this.reset(),this.particle.addForce(new c(a.gravity.x,a.gravity.y,0)),this.particle.integrate(b),this.draw(a.ctx)},f.prototype.draw=function(a){a.fillStyle="black",a.beginPath(),a.arc(this.particle.current.x,this.particle.current.y,5,0,6.24,0),a.closePath(),a.fill()},a.ball=new f,a.fire=function(){return a.animFrame?(window.cancelAnimationFrame(a.animFrame),a.animFrame=null,void 0):(a.ball.reset(),a.animFrame=window.requestAnimationFrame(e),void 0)}}]),angular.module("mctApp").controller("SpringCtrl",["$scope","World","Vector3",function(a,b){function c(){a.ctx.clearRect(0,0,800,500)}function d(){c(),a.world.simulate(.2),a.ball1.draw(a.ctx),a.ball2.draw(a.ctx),a.spring.draw(a.ctx),a.animFrame=window.requestAnimationFrame(d)}a.canvas=angular.element(document.getElementById("spring-demo"))[0],a.canvas.width=800,a.canvas.height=500,a.ctx=a.canvas.getContext("2d"),a.ctx.fillStyle="#ddd",a.ctx.fillRect(0,0,800,500),a.world=new b;var e=function(b,c,d){this.body=a.world.addParticle(b,c,0,1),this.fill=d,this.draw(a.ctx)};e.prototype.checkBounds=function(){return this.body.getCurrent().x<0||this.body.getCurrent().x>800||this.body.position.y<0||this.body.position.y>500?(this.reset(),!0):!1},e.prototype.draw=function(a){a.fillStyle=this.fill,a.beginPath(),a.arc(this.body.getCurrent().x,this.body.getCurrent().y,15,0,6.24,0),a.closePath(),a.fill()};var f=function(b,c,d,e){this.spring=a.world.addSpringForceGenerator(b,c,d,e),this.draw(a.ctx)};f.prototype.draw=function(a){a.beginPath(),a.strokeStyle="red",a.lineWidth=3,a.moveTo(this.spring.p1.getCurrent().x,this.spring.p1.getCurrent().y),a.lineTo(this.spring.p2.getCurrent().x,this.spring.p2.getCurrent().y),a.stroke()},a.ball1=new e(250,100,"blue"),a.ball2=new e(400,100,"green"),a.spring=new f(a.ball1.body,a.ball2.body,10,100),d()}]),angular.module("mctApp").controller("ClothCtrl",["$scope","World","Vector3",function(a,b,c){function d(){a.ctx.clearRect(0,0,500,500);var b,c,e;for(b=0;j>b;++b)a.world.simulate(.5);for(a.constraints.forEach(function(b){b.draw(a.ctx)}),b=0;g>b;++b)for(c=0;f>c;++c)e=a.points[b][c],e.draw(a.ctx);a.animFrame=window.requestAnimationFrame(d)}function e(b,d){var e,h,i,j=new c(b,d,0),k=100,l=null,m=a.points;for(h=0;g>h;++h)for(i=0;f>i;++i)e=j.sub(m[h][i].body.getCurrent()).getMagnitude(),k>e&&(k=e,l=m[h][i]);return l}a.canvas=angular.element(document.getElementById("cloth-demo"))[0],a.canvas.width=500,a.canvas.height=500,a.ctx=a.canvas.getContext("2d"),a.ctx.fillStyle="#ddd",a.ctx.fillRect(0,0,500,500);var f,g,h,i,j;a.opts={rows:15,columns:15,gravity:.1,k:25,iterations:10},a.$watch("opts",function(){a.reset()},!0),a.animFrame=null;var k=null,l=function(b,c){this.body=a.world.addParticle(b+75,c+50,0,1),this.fill="black"};l.prototype.draw=function(a){a.fillStyle=this.fill,a.beginPath(),a.arc(this.body.getCurrent().x,this.body.getCurrent().y,3,0,6.24,0),a.closePath(),a.fill()};var m=function(b,c,d){this.body=a.world.addSpringForceGenerator(b,c,d)};m.prototype.draw=function(a){var b=this.body.p1.getCurrent(),c=this.body.p2.getCurrent();a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(c.x,c.y),a.stroke()},a.reset=function(){window.cancelAnimationFrame(a.animFrame),f=a.opts.rows,g=a.opts.columns,h=a.opts.gravity,i=a.opts.k,j=a.opts.iterations,a.world=new b,a.world.damping=.01,a.world.addGravity(0,h,0),a.points=[],a.constraints=[];var c,e,k=(a.canvas.width-100)/g,n=(a.canvas.height-200)/f;for(c=0;g>c;++c)for(a.points[c]=[],e=0;f>e;++e)a.points[c].push(new l(c*k,e*n));var o,p;for(c=0;g>c;++c)for(e=0;f>e;++e)c>0&&(o=a.points[c-1][e].body,p=a.points[c][e].body,a.constraints.push(new m(o,p,i))),e>0&&(o=a.points[c][e-1].body,p=a.points[c][e].body,a.constraints.push(new m(o,p,i)));a.points[0][0].body.inverseMass=0,a.points[Math.floor(g/2)][0].body.inverseMass=0,a.points[g-1][0].body.inverseMass=0,d()},a.reset(),a.handleMouseDown=function(a){var b=a.offsetX,c=a.offsetY;k=e(b,c),k.fill="red",k.body.isSelected=!0,k.body.inverseMass=0},a.handleMouseMove=function(a){if(k){var b=a.offsetX,c=a.offsetY;k.body.moveTo(b,c,0)}},a.handleMouseUp=function(){k&&(k.body.isSelected=null,k.fill="black",k=null)}}]),angular.module("mctApp").controller("CollisionsCtrl",["$scope","World",function(a,b){function c(){a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height)}function d(){c();for(var b=0;2>b;++b)a.world.simulate(.2);a.balls.forEach(function(b){b.draw(a.ctx)}),a.animFrame=window.requestAnimationFrame(d)}a.canvas=angular.element(document.getElementById("collisions-demo"))[0],a.canvas.width=500,a.canvas.height=500,a.ctx=a.canvas.getContext("2d"),a.numBalls=25,a.maxSpeed=50,a.restitution=1,a.world=new b,a.world.damping=0,a.world.addGravity(0,0,0),a.world.addBoundaries({x:0,y:0,width:a.canvas.width,height:a.canvas.height}),a.animFrame=null;var e=function(b,c){this.body=a.world.addParticle(b,c,0,1),this.draw(a.ctx)};e.prototype.draw=function(a){var b=this.body.getCurrent();a.beginPath(),a.fillStyle="black",a.arc(b.x,b.y,10,0,6.28,0),a.fill()},a.reset=function(){c(),a.balls=[];var b,f,g,h,i,j;for(f=0;f<a.numBalls;++f)g=Math.random()*a.canvas.width,h=Math.random()*a.canvas.height,i=2*Math.random()*a.maxSpeed-a.maxSpeed,j=2*Math.random()*a.maxSpeed-a.maxSpeed,b=new e(g,h),a.balls.push(b),b.body.accelerate(i,j,0);d()},a.reset()}]),angular.module("mctApp").directive("demo",function(){return{template:"<div></div>",restrict:"E",link:function(a,b){b.text("this is the demo directive")}}}),angular.module("mctApp").controller("MusicCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("mctApp").controller("TunerCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("mctApp").controller("DrumkitCtrl",["$scope","$filter","Drumkit",function(a,b,c){var d=!1;a.drumkit=new c,a.tempo=120,a.kit="kit1",a.beats=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],a.instruments=a.drumkit.rhythm.channels,a.measures=b("groupBy")(a.beats,4),a.loadRhythm=function(b){a.drumkit.rhythm.load(a.drumkit.rhythm.demos[b])},a.loadKit=function(){var b=a.kit;a.instruments.forEach(function(c){a.drumkit.loadSound("/sounds/"+b+"/"+c+".wav",c)})},a.play=function(){d=!d,d?a.drumkit.handlePlay():a.drumkit.handleStop()},a.stop=function(){a.drumkit.handleStop()},a.toggleBeat=function(b,c){d=a.drumkit.rhythm[b].beat[c];var e=a.drumkit.rhythm[b].beat[c]=d?0:1;return e},a.getBeatClass=function(b,c){return a.drumkit.rhythm[b].beat[c]?"active":void 0},a.$watch("kit",function(){return console.log(a.kit),a.loadKit()}),a.$watch("tempo",function(){a.drumkit.tempo=a.tempo}),a.loadRhythm(0)}]),angular.module("mctApp").factory("Rhythm",function(){var a=function(){this.channels=["Kick1","Snare1","ClHat1","OpHat1","Tom1","Tom2","Tom3","Cymbal"],this.reset()};return a.prototype.demos=[{channels:["Kick1","Snare1","ClHat1","OpHat1","Tom1","Tom2","Tom3","Cymbal"],Tom1:{beat:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],pitch:1,mainGain:1,sendGain:1,pan:!0,x:-100,y:0,z:0,buffer:"Tom1"},Tom2:{beat:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],pitch:1,mainGain:1,sendGain:1,pan:!0,x:100,y:0,z:0,buffer:"Tom2"},Tom3:{beat:[1,1,0,0,1,1,0,0,1,0,1,0,1,0,1,1],pitch:1,mainGain:1,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"Tom3"},ClHat1:{beat:[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],pitch:1,mainGain:1,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"ClHat1"},OpHat1:{beat:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],pitch:1,mainGain:1,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"OpHat1"},Kick1:{beat:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],pitch:1,mainGain:1,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"Kick1"},Snare1:{beat:[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],pitch:1,mainGain:1,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"Snare1"},Cymbal:{beat:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],pitch:1,mainGain:.8,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"Cymbal"}},{channels:["Kick1","Snare1","ClHat1","OpHat1","Tom1","Tom2","Tom3","Cymbal"],Tom1:{beat:[1,1,1,1,1,1,1,1,1,1,0,0,1,0,0,0],pitch:1,mainGain:1,sendGain:1,pan:!0,x:-100,y:0,z:0,buffer:"Tom1"},Tom2:{beat:[1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1],pitch:1,mainGain:1,sendGain:1,pan:!0,x:100,y:0,z:0,buffer:"Tom2"},Tom3:{beat:[1,1,0,0,1,1,0,0,1,0,1,0,1,0,1,1],pitch:1,mainGain:1,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"Tom3"},ClHat1:{beat:[1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0],pitch:1,mainGain:1,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"ClHat1"},OpHat1:{beat:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],pitch:1,mainGain:1,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"OpHat1"},Kick1:{beat:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],pitch:1,mainGain:1,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"Kick1"},Snare1:{beat:[1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],pitch:1,mainGain:1,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"Snare1"},Cymbal:{beat:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],pitch:1,mainGain:.8,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:"Cymbal"}}],a.prototype.playNote=function(a){this.channels.forEach(function(b){var c=this[b];b.beat[a]&&this.playSound(c.buffer)},this)},a.prototype.reset=function(){this.channels.forEach(function(a){this[a]={beat:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],pitch:1,mainGain:1,sendGain:1,pan:!1,x:0,y:0,z:0,buffer:a}},this)},a.prototype.load=function(a){this.channels=a.channels,this.channels.forEach(function(b){this[b]={beat:a[b].beat,pitch:a[b].pitch,mainGain:a[b].mainGain,sendGain:a[b].sendGain,buffer:a[b].buffer}},this)},a}),angular.module("mctApp").factory("Drumkit",["Rhythm",function(a){var b=function(){this.context=new window.webkitAudioContext,this.effectDryMix=1,this.effectWetMix=1,this.timerId=1,this.startTime=0,this.currentNote=0,this.tempo=120,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.noteLength=.05,this.noteQueue=[],this.context.createDynamicsCompressor?(this.compressor=this.context.createDynamicsCompressor(),this.compressor.connect(this.context.destination),this.finalMixNode=this.compressor):this.finalMixNode=this.context.destination,this.masterGainNode=this.context.createGain(),this.masterGainNode.gain.value=.7,this.masterGainNode.connect(this.finalMixNode),this.effectLevelNode=this.context.createGain(),this.effectLevelNode.gain.value=1,this.effectLevelNode.connect(this.masterGainNode),this.convolver=this.context.createConvolver(),this.convolver.connect(this.effectLevelNode),this.sounds={},this.rhythm=new a,this.scheduler=this.schedule.bind(this)};return b.prototype.loadSound=function(a,b){var c=this,d=this.context,e=new XMLHttpRequest;e.open("GET",a,!0),e.responseType="arraybuffer",e.onload=function(){d.decodeAudioData(e.response,function(a){c.sounds[b]=a},function(a){a&&console.log(a)})},e.send()},b.prototype.playSound=function(a){var b=this.context.createBufferSource();b.buffer=this.sounds[a],b.connect(this.context.destination),b.start(0)},b.prototype.advanceNote=function(){var a=60/this.tempo;this.currentNote++,this.currentNote=this.currentNote%16,this.nextNoteTime+=.25*a,console.log(this.currentNote)},b.prototype.playNote=function(a,b){var c,d=this.context.createBufferSource();if(d.buffer=this.sounds[a.buffer],a.pan){var e=this.context.createPanner();e.setPosition(a.x,a.y,a.z),d.connect(e),c=e}else c=d;var f=this.context.createGain();f.gain.value=a.mainGain*this.effectDryMix,c.connect(f),f.connect(this.masterGainNode);var g=this.context.createGain();return g.gain.value=a.sendGain*this.effectWetMix,c.connect(g),g.connect(this.convolver),d.start(b)},b.prototype.scheduleChannel=function(a,b){var c=this.rhythm[a];c.beat[this.currentNote]&&this.playNote(c,b)},b.prototype.schedule=function(){for(var a=this.context.currentTime-this.startTime;this.nextNoteTime<a+this.scheduleAheadTime;){var b=this.nextNoteTime+this.startTime;this.rhythm.channels.forEach(function(a){var c=this.rhythm[a];c.beat[this.currentNote]&&this.playNote(c,b)},this),this.advanceNote()}return this.timerId=setTimeout(this.scheduler,this.lookahead),this.timerId},b.prototype.handlePlay=function(){return this.nextNoteTime=0,this.startTime=this.context.currentTime+this.noteLength,this.schedule()},b.prototype.handleStop=function(){return clearTimeout(this.timerId)},b}]),angular.module("mctApp").directive("toggle",function(){return{replace:!0,template:'<button class="btn btn-success" ng-click="toggle()">{{text}}</button>',restrict:"E",link:function(a,b,c){a.active=!1,a.text=c.off,a.toggle=function(){a[c.action](),a.active?(b.removeClass("btn-danger"),b.addClass("btn-success"),a.text=c.off,a.active=!1):(b.removeClass("btn-success"),b.addClass("btn-danger"),a.text=c.on,a.active=!0)}}}});